server {
    server_name <%= "#{@fqdn}" %>;
    listen 80 default_server;
    return 301 https://<%= "#{@fqdn}" %>/status;
}

server {
    server_name <%= "#{@fqdn}" %>;
    <% unless node['proxy']['ssl_verify_client'] %>
    ssl_verify_client off;
    <% end %>
    ssl_certificate <%= "#{@ssl_cert}" %>;
    ssl_certificate_key <%= "#{@ssl_key}" %>;

    listen 443 ssl default_server;

    root <%= "/var/www/#{node['application']}/public" %>;

    rewrite ^(.+)/+$ $1 permanent;

    location = /status {
        alias <%= "/var/www/#{node['application']}/public" %>/status/index.html;
        autoindex off;
        default_type text/html;
    }

    location / {
        return 301 https://<%= "#{@fqdn}" %>/status;
    }
}
